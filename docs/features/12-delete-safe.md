# 12. Delete Safe (Soft Delete)

## –ö–∞—Ç–µ–≥–æ—Ä–∏—è
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (Management Tools)

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
üî• **P0** (–ö—Ä–∏—Ç–∏—á–Ω–æ)

## –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–ª—è AI
‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)

## –û–ø–∏—Å–∞–Ω–∏–µ
–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–æ—Ä–∑–∏–Ω—É `.gofer/trash/`.

## –ü—Ä–æ–±–ª–µ–º–∞
AI –º–æ–∂–µ—Ç –æ—à–∏–±–∏—Ç—å—Å—è –∏ —É–¥–∞–ª–∏—Ç—å –≤–∞–∂–Ω—ã–π —Ñ–∞–π–ª. –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ ‚Äî —ç—Ç–æ –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–∞. –ù—É–∂–Ω–∞ –∫–æ—Ä–∑–∏–Ω–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞.

## –°–∏–≥–Ω–∞—Ç—É—Ä–∞
```
delete_safe(path, reason, tags) -> DeletionResult
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `path` (string) ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- `reason` (string, optional) ‚Äî –ø—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- `tags` (array<string>, optional) ‚Äî —Ç–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["refactor", "deprecated"]`)

## –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```json
{
  "deletion_uuid": "d4e5f6a7-...",
  "original_path": "src/old_module.rs",
  "size_saved": "15.4 KB",
  "timestamp": "2026-02-25T10:30:00Z",
  "trash_location": "~/.gofer/indices/<project-uuid>/trash/d4e5f6a7-.../"
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
~/.gofer/indices/<project-uuid>/trash/
  <deletion-uuid>/
    metadata.json      # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è
    content/          # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
```

### metadata.json
```json
{
  "deletion_uuid": "d4e5f6a7-...",
  "original_path": "src/auth/old_module.rs",
  "deleted_at": "2026-02-25T10:30:00Z",
  "deleted_by": "ai_agent",
  "reason": "Refactoring: merged into main auth module",
  "file_type": "file",
  "size_bytes": 15420,
  "sha256": "e3b0c44298fc1c14...",
  "git_commit": "abc123",
  "tags": ["refactor", "auth_module"]
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø—Ä–∏—á–∏–Ω–æ–π
```
AI: delete_safe("src/auth/legacy.rs", reason="Replaced by new auth system", tags=["refactor"])
Result: —Ñ–∞–π–ª –ø–µ—Ä–µ–º–µ—â—ë–Ω –≤ trash —Å UUID
```

### –ü—Ä–∏–º–µ—Ä 2: –£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```
AI: delete_safe("src/old_components/", reason="Migrated to new structure", tags=["migration"])
Result: –≤—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ trash
```

### –ü—Ä–∏–º–µ—Ä 3: –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```
AI: delete_safe("src/test_file.rs")
Result: —Ñ–∞–π–ª —É–¥–∞–ª—ë–Ω, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### list_trash(filter)
–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã.

### restore(deletion_uuid, target_path)
–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.

### purge_trash(filter)
–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `20-trash-management.md`

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: AI –º–æ–∂–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
- **–ü–æ–∏—Å–∫**: —Ç–µ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–π—Ç–∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ N –¥–Ω–µ–π

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
–ï—Å–ª–∏ `delete_safe()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ä–µ–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `commit_transaction()`. –ü—Ä–∏ `rollback_transaction()` —Ñ–∞–π–ª –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ.

## –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
–°—Ä–µ–¥–Ω—è—è (3-4 –¥–Ω—è)

## –°—Ç–∞—Ç—É—Å –≤ gofer
‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- filesystem API
- UUID generation
- SHA256 hashing (–¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- git2 (–¥–ª—è git_commit –≤ metadata)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```toml
[trash]
enabled = true
auto_cleanup_days = 30
max_size_mb = 500
auto_purge_on_limit = true
ignore_patterns = ["*.tmp", "*.log", "node_modules/**"]
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–æ–ø–∞—Å–Ω–æ)
- Git –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–º–∏—Ç–æ–≤)
- –í–Ω–µ—à–Ω–∏–π filesystem MCP —Å trash

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `restore` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- `list_trash` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ—Ä–∑–∏–Ω—ã
- `purge_trash` ‚Äî –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- –°–º. –ø–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `20-trash-management.md`

# 08. Patch File (Search & Replace)

## –ö–∞—Ç–µ–≥–æ—Ä–∏—è
–¢–æ—á–µ—á–Ω–∞—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è (Write Tools)

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
üî• **P0** (–ö—Ä–∏—Ç–∏—á–Ω–æ)

## –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ –¥–ª—è AI
‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)

## –û–ø–∏—Å–∞–Ω–∏–µ
–£–ª—å—Ç–∏–º–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è AI: —Ç–æ—á–µ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∫–æ–¥–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞.

## –ü—Ä–æ–±–ª–µ–º–∞
AI —á–∞—Å—Ç–æ –æ—à–∏–±–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —Ü–µ–ª–∏–∫–æ–º —Ä–∞–¥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –≠—Ç–æ —Ç—Ä–∞—Ç–∏—Ç —Ç–æ–∫–µ–Ω—ã –∏ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –∫–æ–¥–∞. –ù—É–∂–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç.

## –°–∏–≥–Ω–∞—Ç—É—Ä–∞
```
patch_file(path, search_string, replace_string, occurrence) -> PatchResult
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `path` (string) ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `search_string` (string) ‚Äî —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
- `replace_string` (string) ‚Äî —Ç–µ–∫—Å—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã
- `occurrence` (number, optional) ‚Äî –∫–∞–∫–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –∑–∞–º–µ–Ω–∏—Ç—å (1-indexed, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–µ—Ä–≤–æ–µ)
  - `0` = –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è
  - `1` = –∑–∞–º–µ–Ω–∏—Ç—å –ø–µ—Ä–≤–æ–µ
  - `2` = –∑–∞–º–µ–Ω–∏—Ç—å –≤—Ç–æ—Ä–æ–µ, –∏ —Ç.–¥.

## –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```json
{
  "path": "src/auth.rs",
  "status": "patched",
  "occurrences_found": 3,
  "occurrences_replaced": 1,
  "lines_changed": [42, 43, 44],
  "diff": "@@ -42,3 +42,3 @@\n-    fn login() {\n+    fn authenticate() {\n"
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
```
AI: patch_file(
  "src/auth.rs", 
  search_string="fn login(", 
  replace_string="fn authenticate("
)
Result: –∑–∞–º–µ–Ω–µ–Ω–æ 1 –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 42
```

### –ü—Ä–∏–º–µ—Ä 2: –ó–∞–º–µ–Ω–∞ –±–ª–æ–∫–∞ –∫–æ–¥–∞
```
AI: patch_file(
  "src/api.rs",
  search_string="    if user.is_admin {\n        return true;\n    }",
  replace_string="    if user.role == Role::Admin {\n        return true;\n    }"
)
Result: –∑–∞–º–µ–Ω—ë–Ω –±–ª–æ–∫ –∏–∑ 3 —Å—Ç—Ä–æ–∫
```

### –ü—Ä–∏–º–µ—Ä 3: –ó–∞–º–µ–Ω–∞ –≤—Å–µ—Ö –≤—Ö–æ–∂–¥–µ–Ω–∏–π
```
AI: patch_file(
  "src/utils.rs",
  search_string="println!(",
  replace_string="log::info!(",
  occurrence=0  // –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ
)
Result: –∑–∞–º–µ–Ω–µ–Ω–æ 15 –≤—Ö–æ–∂–¥–µ–Ω–∏–π
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- **–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤**: AI –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –∑–∞–Ω–æ–≤–æ
- **–°–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫**: –Ω–µ—Ç —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä–∏ –∫–æ–¥–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
- **–¢–æ—á–Ω–æ—Å—Ç—å**: AI —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –∑–∞–º–µ–Ω—ã
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –µ—Å–ª–∏ search_string –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –æ—à–∏–±–∫–∞ (–∞ –Ω–µ –º–æ–ª—á–∞–ª–∏–≤–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å)

## Error Handling

### –û—à–∏–±–∫–∞: search_string –Ω–µ –Ω–∞–π–¥–µ–Ω
```json
{
  "status": "error",
  "error": "search_string_not_found",
  "message": "Could not find 'fn login(' in src/auth.rs",
  "suggestion": "Use read_file or search_files to verify the exact string"
}
```

### –û—à–∏–±–∫–∞: –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```json
{
  "status": "error",
  "error": "ambiguous_match",
  "message": "Found 3 occurrences of 'fn process()'. Specify occurrence parameter.",
  "matches": [
    {"line": 42, "context": "..."},
    {"line": 158, "context": "..."},
    {"line": 302, "context": "..."}
  ]
}
```

## –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
–°—Ä–µ–¥–Ω—è—è (3 –¥–Ω—è)

## –°—Ç–∞—Ç—É—Å –≤ gofer
‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –µ—Å—Ç—å `verify_patch` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ç—á–∞)

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- filesystem API
- `verify_patch` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é –ø–æ—Å–ª–µ –ø–∞—Ç—á–∞)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- `write_file` ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å (–æ–ø–∞—Å–Ω–æ –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)
- –í–Ω–µ—à–Ω–∏–π MCP —Å edit capabilities

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `verify_patch` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ç—á –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- `write_file` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- `read_file_chunk` ‚Äî –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –ø–∞—Ç—á–µ–º

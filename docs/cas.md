# CAS (Content-Addressable Storage)

–≠—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Å–∏–ª—å–Ω—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ö–æ–¥. –ó–∞—Å—Ç–∞–≤–ª—è—Ç—å –ò–ò –ø–∏—Å–∞—Ç—å **reason (–ø—Ä–∏—á–∏–Ω—É)** ‚Äî —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Chain-of-Thought (—Ü–µ–ø–æ—á–∫–∞ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π) –ø—Ä—è–º–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ API —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã!

–ö–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –≤—ã–Ω—É–∂–¥–µ–Ω–∞ –æ–±—ä—è—Å–Ω–∏—Ç—å, *–∑–∞—á–µ–º* –æ–Ω–∞ –≤—ã—Ä–µ–∑–∞–µ—Ç –∫—É—Å–æ–∫ –∫–æ–¥–∞, –æ–Ω–∞ –≥–æ—Ä–∞–∑–¥–æ —Ä–µ–∂–µ —Å–æ–≤–µ—Ä—à–∞–µ—Ç –≥–ª—É–ø—ã–µ –æ—à–∏–±–∫–∏. –ê –¥–ª—è –≤–∞—Å, –∫–∞–∫ —Ä–µ–≤—å—é–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ UI, —ç—Ç–æ –±–µ—Å—Ü–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

–î–∞–≤–∞–π—Ç–µ —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ–º, –∫–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ Rust-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools) –º—ã –¥–∞–¥–∏–º –Ω–∞—à–µ–º—É "—Å—É—Å–ª–∏–∫—É" Gofer.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ 

–ü–æ—Å–∫–æ–ª—å–∫—É —è–¥—Ä–æ –º—ã –ø–∏—à–µ–º –Ω–∞ Rust, –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º —ç—Ç–æ—Ç —Å–ª–æ–≤–∞—Ä—å –±—É–¥–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ `serde_json` –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ —Ç–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```rust
use serde::{Deserialize, Serialize};
use std::collections::HashMap;

#[derive(Serialize, Deserialize)]
struct CasEntry {
    name: String,      // –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "User schema definition")
    reason: String,    // –ó–∞—á–µ–º —ç—Ç–æ –∑–¥–µ—Å—å? (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–í—ã–Ω–µ—Å –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ auth.ts")
    ts: u64,           // Unix timestamp
    original_path: Option<String>, // –û—Ç–∫—É–¥–∞ –≤—ã—Ä–µ–∑–∞–ª–∏ (–µ—Å–ª–∏ —ç—Ç–æ –±—ã–ª cut/copy)
}

// –°–∞–º dictionary.json ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ HashMap<String, CasEntry>

```

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–º–µ—â–µ–Ω–∏—è –≤ CAS (Write/Stash Tools)

–ß—Ç–æ–±—ã –Ω–∞–ø–æ–ª–Ω—è—Ç—å —ç—Ç–æ—Ç `.gofer/cas/`, –ò–ò –ø–æ–ª—É—á–∏—Ç –¥–≤–∞ –≥–ª–∞–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

#### 1. `stash_from_file` (–í—ã—Ä–µ–∑–∞—Ç—å/–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç, –∫–æ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç –∏ —Ö–æ—á–µ—Ç –æ—Ç–ª–æ–∂–∏—Ç—å —á–∞—Å—Ç—å –∫–æ–¥–∞ –≤ –±—É—Ñ–µ—Ä –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

* `path` *(string, required)*: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É.
* `start_line` *(number, required)*: –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞.
* `end_line` *(number, required)*: –ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞.
* `action` *(enum: "copy" | "cut", required)*: –û—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–¥ –Ω–∞ –º–µ—Å—Ç–µ –∏–ª–∏ —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (–≤ —Ç–µ–Ω–µ–≤–æ–º —Å—Ç–µ–π—Ç–µ).
* `name` *(string, required)*: –ö—Ä–∞—Ç–∫–æ–µ –∏–º—è –¥–ª—è —á–∞–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `validateEmailFunction`).
* `reason` *(string, required)*: **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ.** –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π. *–ü—Ä–∏–º–µ—Ä: "–†–∞–∑–±–∏–≤–∞—é –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –í—ã—Ä–µ–∑–∞—é —Ñ—É–Ω–∫—Ü–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ–∑–∂–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ—ë –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π utils-—Ñ–∞–π–ª".*

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Gofer:**

1. –ß–∏—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞.
2. –í—ã—á–∏—Å–ª—è–µ—Ç SHA-256 –æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–∞–Ω–∫ –≤ `.gofer/cas/8f/92a...`
4. –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `.gofer/cas/dictionary.json`.
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ò–ò: `{"status": "success", "hash": "8f92a..."}`

#### 2. `stash_generated` (–ü–æ–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥)

–ò–ò –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç —Å—Ç–∞—Ä–æ–µ, —á–∞—Å—Ç–æ –æ–Ω –ø–∏—à–µ—Ç –Ω–æ–≤—ã–π –∫–æ–¥. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø—ã—Ç–∞—Ç—å—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–Ω—é –Ω–∞ 200 —Å—Ç—Ä–æ–∫ –≤ –Ω—É–∂–Ω—ã–π —Ñ–∞–π–ª (–∏ –æ—à–∏–±–∏—Ç—å—Å—è —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏), –ò–ò —Å–Ω–∞—á–∞–ª–∞ –∫–ª–∞–¥–µ—Ç –µ—ë –≤ CAS.

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

* `content` *(string, required)*: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.
* `desc` *(string, required)*: –ö—Ä–∞—Ç–∫–æ–µ –∏–º—è.
* `reason` *(string, required)*: –ó–∞—á–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —ç—Ç–æ—Ç –∫–æ–¥. *–ü—Ä–∏–º–µ—Ä: "–ù–∞–ø–∏—Å–∞–ª –Ω–æ–≤—ã–π –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è ClickHouse, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –±–∞—Ç—á–∏".*

---

### –ü–æ—á–µ–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `reason` ‚Äî —ç—Ç–æ –∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞?

1. **–ò–¥–µ–∞–ª—å–Ω—ã–π UI –¥–ª—è —Ä–µ–≤—å—é–µ—Ä–∞ (Human-in-the-loop):**
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –¥–∞—à–±–æ—Ä–¥ –Ω–∞ Vue. –í—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ–±—ã –∑–∞–∞–ø–ø—Ä—É–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç –ò–ò. –í–º–µ—Å—Ç–æ —Å–ª–µ–ø–æ–≥–æ diff'–∞ —Ñ–∞–π–ª–æ–≤, —Å–ª–µ–≤–∞ –≤—ã –≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ (–∏–∑ `dictionary.json`):
* üì¶ **`a1b2c`** - *Auth Middleware* * *–ü—Ä–∏—á–∏–Ω–∞:* "–í—ã–Ω–µ—Å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º."


–í—ã —á–∏—Ç–∞–µ—Ç–µ –ø—Ä–∏—á–∏–Ω—É, –ø–æ–Ω–∏–º–∞–µ—Ç–µ –ª–æ–≥–∏–∫—É –ò–ò, —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ diff ‚Äî –∏ –Ω–∞–∂–∏–º–∞–µ—Ç–µ Approve. –≠—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –ò–ò –∏–∑ "—É–≥–∞–¥–∞–π, —á—Ç–æ –æ–Ω —Å–ª–æ–º–∞–ª" –≤ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ –∫–æ–¥-—Ä–µ–≤—å—é.
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Garbage Collection (GC):**
–ï—Å–ª–∏ –ò–ò –ø–æ–ª–æ–∂–∏–ª —á–∞–Ω–∫ –≤ CAS —Å –ø—Ä–∏—á–∏–Ω–æ–π *"–í—Ä–µ–º–µ–Ω–Ω—ã–π –±–µ–∫–∞–ø –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞"*, –º—ã –º–æ–∂–µ–º –ø–æ–∑–∂–µ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∏—Ç —Ç–∞–∫–∏–µ —á–∞–Ω–∫–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ª–æ–≤–∞—Ä—è.
3. **–°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–º–º–∏—Ç–æ–≤:**
–ö–æ–≥–¥–∞ –ò–ò –∑–∞–∫–æ–Ω—á–∏—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç —Ö–µ—à–∏ –ø–æ –º–µ—Å—Ç–∞–º, –º—ã –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –ø–æ–ª—è `reason` –∏–∑ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö —Ö–µ—à–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–µ, –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è `git commit`!

### –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ú—ã –Ω–∞—É—á–∏–ª–∏ –ò–ò —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã –∏ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –∫—É—Å–∫–∏ –∫–æ–¥–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç–Ω—ã–π `.gofer/cas/`, –ø–æ–ø—É—Ç–Ω–æ –æ–±—ä—è—Å–Ω—è—è —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è.

–°–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–Ω—ã–π —à–∞–≥ ‚Äî **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—Å—Ç–∞–≤–∫–∏ (Paste/Apply)**. –ö–∞–∫ –ò–ò –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ö–µ—à–∏, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª? –î–∞–¥–∏–º –µ–º—É —Ñ—É–Ω–∫—Ü–∏—é `apply_template(path, template_with_hashes)` –∏–ª–∏ –∑–∞—Å—Ç–∞–≤–∏–º –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç—Ä–æ—á–Ω–æ —á–µ—Ä–µ–∑ `insert_hash(path, line, hash)`?
